<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Galaxy Types – Cinematic Space with Comets</title>

<style>
html,body{
  margin:0;
  width:100%;
  height:100%;
  overflow:hidden;
  background:#02040c;
  font-family:system-ui;
}

#bgCanvas{
  position:fixed;
  inset:0;
  z-index:0;
}

#threeContainer{
  position:fixed;
  inset:0;
  z-index:1;
}

#panel{
  position:fixed;
  top:10px;
  left:10px;
  z-index:5;
}
button{
  margin:4px;
  padding:6px 10px;
  border:none;
  cursor:pointer;
  font-weight:bold;
  color:#fff;
  background:#111;
  border-radius:6px;
  transition:0.3s;
}
button:hover{
  background:#333;
  box-shadow:0 0 12px #88ccff;
}
button.active{
  box-shadow:0 0 20px #ff88cc,0 0 35px #88ccff;
}

.bgPanel{
  position:fixed;
  right:12px;
  bottom:12px;
  z-index:5;
  background:rgba(0,0,0,.6);
  padding:10px 14px;
  border-radius:12px;
  color:#fff;
  font-size:12px;
}
.bgPanel input{width:160px}
</style>
</head>

<body>

<canvas id="bgCanvas"></canvas>
<div id="threeContainer"></div>

<div id="panel">
  <button onclick="loadGalaxy('spiral', this)">Spiral</button>
  <button onclick="loadGalaxy('elliptical', this)">Elliptical</button>
  <button onclick="loadGalaxy('ring', this)">Ring</button>
  <button onclick="loadGalaxy('irregular', this)">Irregular</button>
  <button onclick="loadGalaxy('dwarf', this)">Dwarf</button>
</div>

<div class="bgPanel">
  ⭐ Star Speed<br>
  <input type="range" id="speed" min="0.5" max="8" value="4">
</div>

<script>
/* ===== 2D BACKGROUND STARS ===== */
const bg = document.getElementById("bgCanvas");
const ctx = bg.getContext("2d");
function resizeBG(){ bg.width=innerWidth; bg.height=innerHeight; }
addEventListener("resize", resizeBG); resizeBG();

let SPEED = 4;
document.getElementById("speed").oninput = e=>SPEED=+e.target.value;

const bgStars=[];
const DEPTH=1200;
for(let i=0;i<1400;i++){
  bgStars.push({x:(Math.random()-0.5)*innerWidth,y:(Math.random()-0.5)*innerHeight,z:Math.random()*DEPTH,s:Math.random()*1.5+0.5});
}

function drawBG(){
  ctx.fillStyle="#02040c";
  ctx.fillRect(0,0,bg.width,bg.height);
  ctx.translate(bg.width/2,bg.height/2);
  ctx.globalCompositeOperation="lighter";
  for(const s of bgStars){
    s.z-=SPEED; if(s.z<1) s.z=DEPTH;
    const k=300/s.z;
    ctx.fillStyle="#88ccff";
    ctx.fillRect(s.x*k,s.y*k,s.s,s.s);
  }
  ctx.setTransform(1,0,0,1,0,0);
  requestAnimationFrame(drawBG);
}
drawBG();
</script>

<script src="https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.min.js"></script>
<script>
/* ===== THREE.JS SCENE ===== */
const scene=new THREE.Scene();
scene.background=new THREE.Color(0x02040c);
const camera=new THREE.PerspectiveCamera(60,innerWidth/innerHeight,0.1,2000);
camera.position.z=120;

const renderer=new THREE.WebGLRenderer({antialias:true, alpha:false});
renderer.setSize(innerWidth,innerHeight);
renderer.setPixelRatio(devicePixelRatio);
renderer.setClearColor(0x02040c,1);
document.getElementById("threeContainer").appendChild(renderer.domElement);

/* ===== SPACE STARS ===== */
const starGeo=new THREE.BufferGeometry();
const starCount=40000;
const starPos=new Float32Array(starCount*3);
for(let i=0;i<starCount;i++){
  starPos[i*3]=(Math.random()-0.5)*1000;
  starPos[i*3+1]=(Math.random()-0.5)*1000;
  starPos[i*3+2]=(Math.random()-0.5)*1000;
}
starGeo.setAttribute("position",new THREE.BufferAttribute(starPos,3));

const sprite=new THREE.TextureLoader().load("https://threejs.org/examples/textures/sprites/circle.png");
const spaceStars=new THREE.Points(starGeo,new THREE.PointsMaterial({map:sprite,size:1.2,color:0xffffff}));
scene.add(spaceStars);

let galaxy, core;

/* ===== GALAXY TYPES ===== */
function loadGalaxy(type, btn=null){
  if(galaxy) scene.remove(galaxy);
  if(core) scene.remove(core);

  const geo=new THREE.BufferGeometry();
  const count=16000;
  const pos=new Float32Array(count*3);
  const col=new Float32Array(count*3);

  for(let i=0;i<count;i++){
    let x=0,y=0,z=0; const r=Math.random()*50;
    if(type==="spiral"){
      const a=(i%4)/4*Math.PI*2+r*0.25; x=Math.cos(a)*r; z=Math.sin(a)*r;
    }else if(type==="elliptical"){
      const theta=Math.random()*2*Math.PI, phi=(Math.random()-0.5)*Math.PI*0.6, radius=15+Math.random()*20;
      x=radius*Math.cos(phi)*Math.cos(theta); y=radius*Math.sin(phi); z=radius*Math.cos(phi)*Math.sin(theta);
    }else if(type==="ring"){
      const a=Math.random()*Math.PI*2, rr=30+Math.random()*4;
      x=Math.cos(a)*rr; z=Math.sin(a)*rr;
    }else if(type==="irregular"){
      const theta=Math.random()*2*Math.PI, phi=(Math.random()-0.5)*Math.PI*0.4, radius=30+Math.random()*30;
      x=radius*Math.cos(phi)*Math.cos(theta); y=radius*Math.sin(phi); z=radius*Math.cos(phi)*Math.sin(theta);
    }else{x=(Math.random()-0.5)*15; y=(Math.random()-0.5)*15; z=(Math.random()-0.5)*15;}

    pos[i*3]=x; pos[i*3+1]=y; pos[i*3+2]=z;
    const c=new THREE.Color().setHSL(Math.random(),0.7,0.6);
    col[i*3]=c.r; col[i*3+1]=c.g; col[i*3+2]=c.b;
  }

  geo.setAttribute("position",new THREE.BufferAttribute(pos,3));
  geo.setAttribute("color",new THREE.BufferAttribute(col,3));

  galaxy=new THREE.Points(geo,new THREE.PointsMaterial({
    map:sprite,size:0.45,vertexColors:true,transparent:true,blending:THREE.AdditiveBlending
  }));
  scene.add(galaxy);

  core=new THREE.Mesh(new THREE.SphereGeometry(5,32,32),new THREE.MeshBasicMaterial({color:0xffffff}));
  scene.add(core);

  if(btn){document.querySelectorAll('#panel button').forEach(b=>b.classList.remove('active')); btn.classList.add('active');}
}
loadGalaxy("spiral");

/* ===== COMETS ===== */
const comets=[];
const cometCount=10;
for(let i=0;i<cometCount;i++){
  const mat=new THREE.MeshBasicMaterial({color:0xffddaa});
  const geo=new THREE.SphereGeometry(0.5,8,8);
  const comet=new THREE.Mesh(geo,mat);
  comet.position.set((Math.random()-0.5)*200,Math.random()*50,(Math.random()-0.5)*200);
  comet.speed=0.5+Math.random();
  comets.push(comet);
  scene.add(comet);
}

/* ===== MOUSE CONTROL ===== */
let down=false,lx=0,ly=0,rx=0,ry=0;
renderer.domElement.onmousedown=e=>{down=true; lx=e.clientX; ly=e.clientY;};
onmouseup=()=>down=false;
onmousemove=e=>{
  if(!down) return;
  ry+=(e.clientX-lx)*0.003; rx+=(e.clientY-ly)*0.003;
  scene.rotation.set(rx,ry,0); lx=e.clientX; ly=e.clientY;
};
onwheel=e=>{camera.position.z+=e.deltaY*0.05; camera.position.z=Math.max(40,Math.min(200,camera.position.z));};

/* ===== ANIMATE ===== */
function animate(){
  requestAnimationFrame(animate);
  if(galaxy) galaxy.rotation.y+=0.0015;
  spaceStars.rotation.y+=0.0004;

  // Core pulsing color
  const t=performance.now()*0.002;
  core.material.color.setHSL((t*50)%360/360,0.9,0.6);
  core.scale.setScalar(1+Math.sin(t*2)*0.1);

  // Animate comets
  for(const c of comets){
    c.position.x-=c.speed;
    c.position.z-=c.speed*0.5;
    if(c.position.x<-100) c.position.x=100;
    if(c.position.z<-100) c.position.z=100;
  }

  renderer.render(scene,camera);
}
animate();

/* ===== RESIZE ===== */
onresize=()=>{
  camera.aspect=innerWidth/innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(innerWidth,innerHeight);
};
</script>

</body>
</html>
