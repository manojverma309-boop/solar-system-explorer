<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Galaxy • Black Hole Glow</title>
<style>
html,body{
  margin:0;
  width:100%;
  height:100%;
  background:#02040c;
  overflow:hidden;
  font-family:Arial;
}
canvas{display:block}

/* UI */
#ui{
  position:fixed;
  bottom:20px;
  left:50%;
  transform:translateX(-50%);
  background:rgba(0,0,0,0.6);
  padding:12px 16px;
  border-radius:14px;
  display:flex;
  align-items:center;
  gap:10px;
  color:#fff;
  flex-wrap:wrap;
}
button{
  border:none;
  padding:7px 14px;
  border-radius:9px;
  cursor:pointer;
  font-weight:bold;
  color:#fff;
}
#toggle{background:linear-gradient(45deg,#1db954,#17c964)}
#toggle.pause{background:linear-gradient(45deg,#ff4757,#ff6b81)}
#create{background:linear-gradient(45deg,#3498db,#6fb1fc)}
label{font-size:12px;opacity:0.8}
input[type=range]{width:110px}
</style>
</head>
<body>

<div id="ui">
  <button id="toggle">▶ Play</button>
  <button id="create">➕ Galaxy</button>

  <label>Speed</label>
  <input type="range" id="speed" min="0" max="3" step="0.1" value="1">
  <span id="speedVal">1.0x</span>

  <label>Black Hole</label>
  <input type="range" id="bh" min="0" max="3" step="0.1" value="1">
  <span id="bhVal">1.0x</span>
</div>

<script src="https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.min.js"></script>
<script>
/* ================= BASIC ================= */
const scene=new THREE.Scene();
const camera=new THREE.PerspectiveCamera(60,innerWidth/innerHeight,0.1,5000);
camera.position.z=220;

const renderer=new THREE.WebGLRenderer({antialias:true});
renderer.setSize(innerWidth,innerHeight);
renderer.setPixelRatio(devicePixelRatio);
document.body.appendChild(renderer.domElement);

/* ================= GLOBAL ================= */
let speed=1;
let bhPower=1; // black hole attraction
let paused=false;
const galaxies=[];

/* ================= STARS ================= */
const starGeo=new THREE.BufferGeometry();
const starCount=4500;
const starPos=new Float32Array(starCount*3);
for(let i=0;i<starCount;i++){
  starPos[i*3]=(Math.random()-0.5)*1700;
  starPos[i*3+1]=(Math.random()-0.5)*1700;
  starPos[i*3+2]=(Math.random()-0.5)*1700;
}
starGeo.setAttribute("position",new THREE.BufferAttribute(starPos,3));
const sprite=new THREE.TextureLoader().load(
 "https://threejs.org/examples/textures/sprites/circle.png"
);
scene.add(new THREE.Points(
  starGeo,
  new THREE.PointsMaterial({map:sprite,size:1.4,transparent:true})
));

/* ================= GALAXY CREATOR ================= */
function createGalaxy(scale=1){
  const geo=new THREE.BufferGeometry();
  const count=12000;
  const pos=new Float32Array(count*3);
  const col=new Float32Array(count*3);
  const radius=45*scale;
  const core=10*scale;
  const arms=4;
  const hues=[0.05,0.15,0.6,0.75];

  for(let i=0;i<count;i++){
    let r,x,y,z;
    if(Math.random()<0.45){
      r=Math.random()*core;
      const t=Math.random()*Math.PI*2;
      const p=Math.acos(2*Math.random()-1);
      x=r*Math.sin(p)*Math.cos(t);
      y=r*Math.cos(p);
      z=r*Math.sin(p)*Math.sin(t);
    }else{
      r=core+Math.random()*(radius-core);
      const a=r*0.45+(i%arms)/arms*Math.PI*2;
      x=Math.cos(a)*r;
      y=(Math.random()-0.5)*2;
      z=Math.sin(a)*r;
    }
    pos.set([x,y,z],i*3);
    const c=new THREE.Color().setHSL(hues[i%arms]+Math.random()*0.04,0.7,0.65);
    col.set([c.r,c.g,c.b],i*3);
  }

  geo.setAttribute("position",new THREE.BufferAttribute(pos,3));
  geo.setAttribute("color",new THREE.BufferAttribute(col,3));

  const mat=new THREE.PointsMaterial({
    map:sprite,
    size:0.35*scale,
    vertexColors:true,
    transparent:true,
    blending:THREE.AdditiveBlending
  });

  const g=new THREE.Points(geo,mat);
  g.userData={vx:0,vy:0,vz:0,dead:false,birth:0};
  g.scale.set(0.01,0.01,0.01);
  return g;
}

/* ================= SPAWN ================= */
function spawnGalaxy(x,y,z){
  const g=createGalaxy(0.45+Math.random()*0.3);
  g.position.set(x,y,z);
  scene.add(g);
  galaxies.push(g);
}
spawnGalaxy(0,0,0);

/* ================= BLACK HOLE ================= */
const BLACK_HOLE_RADIUS=12;
const blackHole=new THREE.Mesh(
  new THREE.SphereGeometry(BLACK_HOLE_RADIUS,32,32),
  new THREE.MeshBasicMaterial({color:0x000000})
);
scene.add(blackHole);

// ✨ Glow behind black hole
const bhGlow=new THREE.Mesh(
  new THREE.SphereGeometry(BLACK_HOLE_RADIUS*2.5,32,32),
  new THREE.MeshBasicMaterial({
    color:0x1a73ff,
    transparent:true,
    opacity:0.15,
    side:THREE.BackSide
  })
);
scene.add(bhGlow);

/* ================= BREAK ================= */
function breakGalaxy(g){
  if(g.userData.dead) return;
  g.userData.dead=true;
  g.userData.fade=1;
  const pos=g.geometry.attributes.position.array;
  const vel=new Float32Array(pos.length);
  for(let i=0;i<vel.length;i++) vel[i]=(Math.random()-0.5)*0.9;
  g.userData.vel=vel;
}

/* ================= CLICK CREATE ================= */
renderer.domElement.addEventListener("click",e=>{
  const mouse=new THREE.Vector2(
    (e.clientX/innerWidth)*2-1,
    -(e.clientY/innerHeight)*2+1
  );
  const ray=new THREE.Raycaster();
  ray.setFromCamera(mouse,camera);
  const pos=ray.ray.origin.clone()
    .add(ray.ray.direction.clone().multiplyScalar(250));
  spawnGalaxy(pos.x,pos.y,pos.z);
});

/* ================= ANIMATE ================= */
function animate(){
  requestAnimationFrame(animate);
  if(paused) return;

  galaxies.forEach(g=>{
    if(g.userData.birth<1){
      g.userData.birth+=0.02*speed;
      g.scale.setScalar(g.userData.birth);
    }

    if(g.userData.dead){
      const pos=g.geometry.attributes.position.array;
      const vel=g.userData.vel;
      for(let i=0;i<pos.length;i++) pos[i]+=vel[i]*speed;
      g.geometry.attributes.position.needsUpdate=true;
      g.material.opacity=g.userData.fade;
      g.userData.fade-=0.02*speed;
      if(g.userData.fade<=0){
        scene.remove(g);
        galaxies.splice(galaxies.indexOf(g),1);
      }
      return;
    }

    g.rotation.y+=0.002*speed;

    const dx=-g.position.x;
    const dy=-g.position.y;
    const dz=-g.position.z;
    const dist=Math.sqrt(dx*dx+dy*dy+dz*dz)+0.001;

    if(dist<BLACK_HOLE_RADIUS){
      breakGalaxy(g);
      return;
    }

    const force=(0.014*bhPower)/dist;
    g.userData.vx+=dx*force*speed;
    g.userData.vy+=dy*force*speed;
    g.userData.vz+=dz*force*speed;

    g.position.x+=g.userData.vx;
    g.position.y+=g.userData.vy;
    g.position.z+=g.userData.vz;
  });

  renderer.render(scene,camera);
}
animate();

/* ================= UI ================= */
const toggle=document.getElementById("toggle");
const speedSlider=document.getElementById("speed");
const bhSlider=document.getElementById("bh");
const speedVal=document.getElementById("speedVal");
const bhVal=document.getElementById("bhVal");

speedSlider.oninput=()=>{
  speed=parseFloat(speedSlider.value);
  speedVal.textContent=speed.toFixed(1)+"x";
};
bhSlider.oninput=()=>{
  bhPower=parseFloat(bhSlider.value);
  bhVal.textContent=bhPower.toFixed(1)+"x";
};

toggle.onclick=()=>{
  paused=!paused;
  toggle.textContent=paused?"▶ Play":"⏸ Pause";
  toggle.classList.toggle("pause",!paused);
};

document.getElementById("create").onclick=()=>{
  spawnGalaxy(
    (Math.random()-0.5)*500,
    (Math.random()-0.5)*300,
    (Math.random()-0.5)*500
  );
};

/* Spacebar */
window.addEventListener("keydown",e=>{
  if(e.code==="Space") toggle.click();
});

/* ================= RESIZE ================= */
onresize=()=>{
  camera.aspect=innerWidth/innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(innerWidth,innerHeight);
};
</script>
</body>
</html>
