<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Galaxy Cluster – Random Galaxies + Solid Core</title>
<style>
html,body{
  margin:0;
  width:100%;
  height:100%;
  background:#02040c;
  overflow:hidden;
}
canvas{display:block}
</style>
</head>
<body>

<script src="https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.min.js"></script>
<script>
/* ================= BASIC ================= */
const scene = new THREE.Scene();

const camera = new THREE.PerspectiveCamera(60,innerWidth/innerHeight,0.1,3000);
camera.position.z = 150;

const renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setSize(innerWidth,innerHeight);
renderer.setPixelRatio(devicePixelRatio);
document.body.appendChild(renderer.domElement);

/* ================= BACKGROUND STARS ================= */
const starGeo = new THREE.BufferGeometry();
const starCount = 3500;
const starPos = new Float32Array(starCount*3);
const starCol = new Float32Array(starCount*3);

for(let i=0;i<starCount;i++){
  starPos[i*3]=(Math.random()-0.5)*1000;
  starPos[i*3+1]=(Math.random()-0.5)*1000;
  starPos[i*3+2]=(Math.random()-0.5)*1000;

  const c=new THREE.Color().setHSL(Math.random(),0.7,0.7);
  starCol.set([c.r,c.g,c.b],i*3);
}
starGeo.setAttribute("position",new THREE.BufferAttribute(starPos,3));
starGeo.setAttribute("color",new THREE.BufferAttribute(starCol,3));

const sprite=new THREE.TextureLoader().load(
 "https://threejs.org/examples/textures/sprites/circle.png"
);

const stars=new THREE.Points(
  starGeo,
  new THREE.PointsMaterial({
    map:sprite,
    size:1.5,
    vertexColors:true,
    transparent:true,
    blending:THREE.AdditiveBlending
  })
);
scene.add(stars);

/* ================= GALAXY CREATOR ================= */
function createGalaxy(scale=1){
  const gGeo=new THREE.BufferGeometry();
  const count=14000;
  const pos=new Float32Array(count*3);
  const col=new Float32Array(count*3);

  const radius=45*scale;
  const coreRadius=10*scale;
  const arms=4;
  const armSpread=1.2*scale;
  const armHeight=2.5*scale;
  const armHues=[0.02,0.15,0.55,0.75];

  for(let i=0;i<count;i++){
    let r,x,y,z;

    if(Math.random()<0.45){ // ⭐ denser core
      r=Math.random()*coreRadius;
      const t=Math.random()*Math.PI*2;
      const p=Math.acos(2*Math.random()-1);
      x=r*Math.sin(p)*Math.cos(t);
      y=r*Math.cos(p);
      z=r*Math.sin(p)*Math.sin(t);
    }else{
      r=coreRadius+Math.random()*(radius-coreRadius);
      const arm=i%arms;
      const a=r*0.45+(arm/arms)*Math.PI*2;
      x=Math.cos(a)*r+(Math.random()-0.5)*armSpread;
      y=(Math.random()-0.5)*armHeight*(1-r/radius);
      z=Math.sin(a)*r+(Math.random()-0.5)*armSpread;
    }

    pos.set([x,y,z],i*3);

    const c=new THREE.Color().setHSL(
      armHues[i%arms]+Math.random()*0.03,
      0.7,
      0.55+Math.random()*0.25
    );
    col.set([c.r,c.g,c.b],i*3);
  }

  gGeo.setAttribute("position",new THREE.BufferAttribute(pos,3));
  gGeo.setAttribute("color",new THREE.BufferAttribute(col,3));

  return new THREE.Points(
    gGeo,
    new THREE.PointsMaterial({
      map:sprite,
      size:0.35*scale,
      vertexColors:true,
      transparent:true,
      blending:THREE.AdditiveBlending
    })
  );
}

/* ================= MAIN GALAXY ================= */
const mainGalaxy = createGalaxy(1);
scene.add(mainGalaxy);

/* ================= SOLID CORE ================= */
const core = new THREE.Mesh(
  new THREE.SphereGeometry(8,32,32),
  new THREE.MeshBasicMaterial({
    color:0xfff1b8,
    transparent:true,
    opacity:0.95
  })
);
scene.add(core);

/* ================= 8 RANDOM GALAXIES ================= */
const smallGalaxies=[];
for(let i=0;i<8;i++){
  const g=createGalaxy(0.35);
  g.position.set(
    (Math.random()-0.5)*400,
    (Math.random()-0.5)*200,
    (Math.random()-0.5)*400
  );
  g.userData={
    vx:(Math.random()-0.5)*0.02,
    vy:(Math.random()-0.5)*0.02,
    vz:(Math.random()-0.5)*0.02
  };
  scene.add(g);
  smallGalaxies.push(g);
}

/* ================= MOUSE ================= */
let down=false,lx=0,ly=0,rx=0,ry=0;
renderer.domElement.onmousedown=e=>{
  down=true; lx=e.clientX; ly=e.clientY;
};
onmouseup=()=>down=false;
onmousemove=e=>{
  if(!down)return;
  ry+=(e.clientX-lx)*0.003;
  rx+=(e.clientY-ly)*0.003;
  scene.rotation.set(rx,ry,0);
  lx=e.clientX; ly=e.clientY;
};
onwheel=e=>{
  camera.position.z+=e.deltaY*0.05;
  camera.position.z=Math.max(60,Math.min(500,camera.position.z));
};

/* ================= ANIMATE ================= */
function animate(){
  requestAnimationFrame(animate);

  mainGalaxy.rotation.y+=0.0015;
  stars.rotation.y+=0.0005;

  const t=performance.now()*0.002;
  const pulse=1+Math.sin(t*0.6)*0.05;
  core.scale.set(pulse,pulse,pulse);

  smallGalaxies.forEach(g=>{
    g.position.x+=g.userData.vx;
    g.position.y+=g.userData.vy;
    g.position.z+=g.userData.vz;
    g.rotation.y+=0.002;
  });

  renderer.render(scene,camera);
}
animate();

/* ================= RESIZE ================= */
onresize=()=>{
  camera.aspect=innerWidth/innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(innerWidth,innerHeight);
};
</script>

</body>
</html>
